<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>User Guide :: Clojurephant</title>
    <link rel="canonical" href="https://clojurephant.dev/clojurephant/main/index.html">
    <meta name="generator" content="Antora 3.0.3">
    <link rel="stylesheet" href="../../_/css/site.css">
    <script>var uiRootPath = '../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://clojurephant.dev">Clojurephant</a>
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <input id="search-input" type="text" placeholder="Search the docs"  autofocus>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="clojurephant" data-version="main">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">clojurephant</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="index.html">User Guide</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="new-gradle.html">New Gradle Users</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="new-clojure.html">New Clojure Users</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="migrate-lein.html">Migrating a build from Leiningen</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="migrate-boot.html">Migrating a build from Boot</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="migrate-deps.html">Migrating a build from deps.edn</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="faq.html">Frequently Asked Questions</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">clojurephant</span>
    <span class="version">main</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="index.html">clojurephant</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">main</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link is-current"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">clojurephant</a></li>
    <li><a href="index.html">User Guide</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/clojurephant/clojurephant/edit/main/docs/modules/ROOT/pages/index.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">User Guide</h1>
<div class="sect1">
<h2 id="_quick_start"><a class="anchor" href="#_quick_start"></a>Quick Start</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Look at our sample projects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/clojurephant/sample-clojurephant-clj-lib" class="bare">https://github.com/clojurephant/sample-clojurephant-clj-lib</a></p>
</li>
<li>
<p><a href="https://github.com/clojurephant/sample-clojurephant-clj-app" class="bare">https://github.com/clojurephant/sample-clojurephant-clj-app</a></p>
</li>
<li>
<p><a href="https://github.com/clojurephant/sample-clojurephant-cljs-app" class="bare">https://github.com/clojurephant/sample-clojurephant-cljs-app</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the documentation doesn&#8217;t answer your questions, please visit the <a href="https://github.com/clojurephant/clojurephant/discussions">Clojurephant Discussions</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_plugins"><a class="anchor" href="#_plugins"></a>Plugins</h2>
<div class="sectionbody">
<div class="paragraph">
<p>clojurephant uses the common Gradle pattern of providing <em>capability</em> plugins and <em>convention</em> plugins. Capability plugins provide the basic machinery for using the language, but leaves it to you to configure. Convention plugins provide configuration on top of the capabilities to support common use cases.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Convention</th>
<th class="tableblock halign-left valign-top">Capability</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dev.clojurephant.clojure</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dev.clojurephant.clojure-base</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dev.clojurephant.clojurescript</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dev.clojurephant.clojurescript-base</code></p></td>
</tr>
</tbody>
</table>
<div class="sect2">
<h3 id="_dev_clojurephant_clojure_base"><a class="anchor" href="#_dev_clojurephant_clojure_base"></a>dev.clojurephant.clojure-base</h3>
<div class="ulist">
<ul>
<li>
<p>Applies <code>java-base</code>, which lets you configure source sets. Each source set will get:</p>
<div class="ulist">
<ul>
<li>
<p>A Java compilation task</p>
</li>
<li>
<p>Configurations for compile (<code>implementation</code>, <code>compileOnly</code>) and runtime (<code>runtimeOnly</code>) dependencies</p>
</li>
</ul>
</div>
</li>
<li>
<p>Adds a <code>clojure</code> extension which allows you to configure builds of your Clojure code.</p>
<div class="ulist">
<ul>
<li>
<p>A build is added for each source set (with the same name as that source set)</p>
</li>
<li>
<p>Additional builds can be configured by the user</p>
</li>
<li>
<p>Each build gets a <code>check&lt;Build&gt;Clojure</code> task that can be used to ensure namespaces compile, and optionally warn or fail on reflection. (by default no namespaces are compiled)</p>
</li>
<li>
<p>Each build gets a <code>compile&lt;Build&gt;Clojure</code> task that can be used for AOT compilation. (by default no namespaces are AOTd)</p>
</li>
<li>
<p>If any namespaces are configured to be AOTed for the source sets build, the source sets output will be the AOTd classes. Otherwise, the Clojure source will be the output (i.e. what would get included in a JAR)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Tip: <code>gradlew tasks --all</code> shows all these created tasks. Beware: The <code>main</code> build is somewhat special and its name is not included in the task names so it has e.g. <code>compileClojure</code>.</p>
</div>
<div class="sect3">
<h4 id="_clojure_builds"><a class="anchor" href="#_clojure_builds"></a>Clojure Builds</h4>
<div class="paragraph">
<p>You can define a custom build:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">clojure {
 builds {
   // Defaults noted here are for custom builds, the convention plugin configures the builds it adds differently
   mybuild {
     sourceSet = sourceSets.mystuff // no default
     // Configuration of the check&lt;Build&gt;Clojure task
     reflection = 'fail' // defaults to 'silent', can also be 'warn'
     checkNamespaces = ['my.core', 'my.base'] // defaults to no namespaces checked
     checkNamespaces.add('my-core') // just add a single namespace
     checkAll() // checks any namespaces found in the source set
     // Configuration of the compile&lt;Build&gt;Clojure task
     compiler {
       disableLocalsClearing = true // defaults to false
       elideMeta = ['doc', 'file'] // defaults to empty list
       directLinking = true // defaults to false
     }
     aotNamespaces = ['my.core', 'my.base'] // defaults to no namespaces aoted
     aotNamespaces.add('my-core') // just add a single namespace
     aotAll() // aots any namespaces found in the source set
   }
 }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also <em>modify</em> the configuration of the auto-added builds, f.ex. the "main" one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>clojure {
    builds {
      main {
        reflection = 'warn'
      }
    }
}</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_dev_clojurephant_clojure"><a class="anchor" href="#_dev_clojurephant_clojure"></a>dev.clojurephant.clojure</h3>
<div class="ulist">
<ul>
<li>
<p>Applies the <code>dev.clojurephant.clojure-base</code> plugin (see above)</p>
</li>
<li>
<p>Applies the <code>java</code> plugin:</p>
<div class="ulist">
<ul>
<li>
<p>Creates a main source set, whose output is packaged into a JAR via the <code>jar</code> task.</p>
</li>
<li>
<p>Creates a test source set, which extends the main source set.</p>
</li>
<li>
<p>Creates a <code>test</code> task that runs tests within the test source set.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Applies the internal <code>ClojureCommonPlugin</code> which:</p>
<div class="ulist">
<ul>
<li>
<p>Creates a dev source set, to be used for REPL development, which extends the test source set.</p>
</li>
<li>
<p>Adds 'nrepl:nrepl' as a dependency of that source set.</p>
</li>
<li>
<p>Adds a <code>clojureRepl</code> task which will start an nREPL server.</p>
</li>
<li>
<p>Configures dependency rules to indicate that:</p>
<div class="ulist">
<ul>
<li>
<p><code>org.clojure:tools.nrepl</code> is replaced by <code>nrepl:nrepl</code></p>
</li>
<li>
<p>If you are using a Java 9+ JVM, any <code>org.clojure:java.classpath</code> dependency must be bumped to at least 1.0.0 to support the new classloader hierarchy.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Configures the <code>main</code> Clojure build to <code>checkAll()</code> namespaces.</p>
</li>
<li>
<p>Configures any build whose name includes <code>test</code> to:</p>
<div class="ulist">
<ul>
<li>
<p><code>aotAll()</code> namespaces (required for the current JUnit4 integration)</p>
</li>
</ul>
</div>
</li>
<li>
<p>Configures the <code>dev</code> Clojure build to <code>checkNamespaces = ['user']</code> (if you have a user namespace). This ensures that your REPL will start successfully.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_dev_clojurephant_clojurescript_base"><a class="anchor" href="#_dev_clojurephant_clojurescript_base"></a>dev.clojurephant.clojurescript-base</h3>
<div class="ulist">
<ul>
<li>
<p>Applies <code>java-base</code>, which lets you configure source sets. Each source set will get:</p>
<div class="ulist">
<ul>
<li>
<p>A Java compilation task</p>
</li>
<li>
<p>Configurations for compile (<code>implementation</code>, <code>compileOnly</code>) and runtime (<code>runtimeOnly</code>) dependencies</p>
</li>
</ul>
</div>
</li>
<li>
<p>Adds a <code>clojurescript</code> extension which allows you to configure builds of your ClojureScript code.</p>
<div class="ulist">
<ul>
<li>
<p>A build is added for each source set (with the same name as that source set)</p>
</li>
<li>
<p>Additional builds can be configured by the user</p>
</li>
<li>
<p>Each build gets a <code>compile&lt;Build&gt;ClojureScript</code> task that can be used for compilation. (by default no compiler options are set)</p>
</li>
<li>
<p>If <code>outputTo</code> is configured (either the top level one or for a module) for the source sets build, the source sets output will be the compiled JS. Otherwise, the ClojureScript source will be the output (i.e. what would get included in a JAR).</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_clojurescript_builds"><a class="anchor" href="#_clojurescript_builds"></a>ClojureScript Builds</h4>
<div class="paragraph">
<p>See <a href="https://clojurescript.org/reference/compiler-options">ClojureScript compiler options</a> for details on what each option does and defaults to.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">clojurescript {
 builds {
   // Defaults noted here are for custom builds, the convention plugin configures the builds it adds differently
   mybuild {
     sourceSet = sourceSets.mystuff // no default
     // Configuration of the compile&lt;Build&gt;ClojureScript task (defaults match what is defaulted in the ClojureScript compile options)
     compiler {
       outputTo = 'public/some/file/path.js' // path is relative to the task's destinationDir
       outputDir = 'public/some/path' // path is relative to the task's destinationDir
       optimizations = 'advanced'
       main = 'foo.bar'
       assetPath = 'public/some/path'
       sourceMap = 'public/some/file/path.js.map' // path is relative to the task's destinationDir
       verbose = true
       prettyPrint = false
       target = 'nodejs'
       // foreignLibs
       externs = ['jquery-externs.js']
       // modules
       // stableNames
       preloads = ['foo.dev']
       npmDeps = ['lodash': '4.17.4']
       installDeps = true
       checkedArrays = 'warn'
     }
   }
 }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_dev_clojurephant_clojurescript"><a class="anchor" href="#_dev_clojurephant_clojurescript"></a>dev.clojurephant.clojurescript</h3>
<div class="ulist">
<ul>
<li>
<p>Applies the <code>dev.clojurephant.clojurescript-base</code> plugin (see above)</p>
</li>
<li>
<p>Applies the <code>java</code> plugin:</p>
<div class="ulist">
<ul>
<li>
<p>Creates a main source set, whose output is packaged into a JAR via the <code>jar</code> task.</p>
</li>
<li>
<p>Creates a test source set, which extends the main source set.</p>
</li>
<li>
<p>Creates a <code>test</code> task that runs tests within the test source set.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Applies the internal <code>ClojureCommonPlugin</code> which:</p>
<div class="ulist">
<ul>
<li>
<p>Creates a dev source set, to be used for REPL development, which extends the test source set.</p>
</li>
<li>
<p>Adds 'nrepl:nrepl' as a dependency of that source set.</p>
</li>
<li>
<p>Adds a <code>clojureRepl</code> task which will start an nREPL server.</p>
</li>
<li>
<p>Configures dependency rules to indicate that:</p>
<div class="ulist">
<ul>
<li>
<p><code>org.clojure:tools.nrepl</code> is replaced by <code>nrepl:nrepl</code></p>
</li>
<li>
<p>If you are using a Java 9+ JVM, any <code>org.clojure:java.classpath</code> dependency must be bumped to at least 1.0.0 to support the new classloader hierarchy.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Wires your ClojureScript build configuration into the nREPL for use by Figwheel.</p>
</li>
<li>
<p>Configures the REPL for Piggieback:</p>
<div class="ulist">
<ul>
<li>
<p>Adds a dev dependency <code>cider:piggieback</code></p>
</li>
<li>
<p>Adds the Piggieback middleware: <code>cider.piggieback/wrap-cljs-repl</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_project_layout"><a class="anchor" href="#_project_layout"></a>Project Layout</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre>&lt;project&gt;/
  src/
    main/
      clojure/
        sample_clojure/
          core.clj
      clojurescript/
        sample_clojure/
          main.cljs
    test/
      clojure/
        sample_clojure/
          core_test.clj
      clojurescript/
        sample_clojure/
          main_test.cljs // right now we don't support cljs.test
    dev/
      clojure/
        user.clj
      clojurescript/
        user.cljs
  gradle/
    wrapper/
      gradle-wrapper.jar
      gradle-wrapper.properties
  build.gradle
  gradlew
  gradlew.bat</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_task_configuration"><a class="anchor" href="#_task_configuration"></a>Task Configuration</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_clojurenrepl"><a class="anchor" href="#_clojurenrepl"></a>ClojureNRepl</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">clojureRepl {
  port = 55555 // defaults to a random open port (which will be written to a .nrepl-port file)

  // handler and middleware are both optional, but don't provide both
  handler = 'cider.nrepl/cider-nrepl-handler' // fully-qualified name of function
  middleware = ['my.stuff/wrap-stuff'] // list of fully-qualified middleware function names (override any existing)
  middleware 'dev/my-middleware', 'dev/my-other-middleware' // one or more full-qualified middleware function names (append to any existing)

  // clojureRepl provides fork options to customize the Java process for compilation
  forkOptions {
    memoryMaximumSize = '2048m'
    jvmArgs = ['-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=5005', '-Djava.awt.headless=true']
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>ClojureNRepl</code> task also supports command-line options for some of it&#8217;s parameters. Multiple <code>middleware</code> must be specified as separate options.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./gradlew clojureRepl --port=1234 --handler=cider.nrepl/cider-nrepl-handler
./gradlew clojureRepl --port=4321 --middleware=dev/my-middleware --middleware=dev/my-other-middleware</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_check_or_compile_tasks"><a class="anchor" href="#_check_or_compile_tasks"></a>check or compile tasks</h3>
<div class="paragraph">
<p>Always configure compiler options and reflection settings via the <code>clojure</code> or <code>clojurescript</code> extensions. These options may be immutable on the tasks at some point in the future.</p>
</div>
<div class="paragraph">
<p>The only settings you should configure directly on the tasks are the forkOptions, if you need to customize the JVM that is used.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">checkClojure {
  // to customize the Java process for compilation
  forkOptions {
    memoryMaximumSize = '2048m'
    jvmArgs = ['-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=5005', '-Djava.awt.headless=true']
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script src="../../_/js/vendor/lunr.js"></script>
<script src="../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../.." data-snippet-length="100" data-stylesheet="../../_/css/search.css"></script>
<script async src="../../search-index.js"></script>
  </body>
</html>
